# Проект: AI-система обработки технических заявок

## Суть проекта

Автоматизация обработки заявок на изготовление продукции. Заявки приходят в разных форматах, требуется извлекать технические параметры и составлять техническую аббревиатуру продукции.

**Цель**: Написать REST API сервис + Web UI.

## Основные функции

1. **Загрузка файлов** - PDF, DOCX, XLSX, PNG, JPG, JPEG
2. **OCR для изображений/PDF**
3. **Извлечение технических параметров продукции из текста заявки**
4. **Соблюдение технических условий (ТУ)** - "ТУ" - это справочник с правилами составления аббревиатуры продукции
5. **Формирование аббревиатуры продукции** - составление по параметрам из заявки с соблюдением ТУ
6. **Сохранение заявок и результатов их обработки**
7. **Дашборд с историей** - часть WEB UI в которой можно просмотреть историю заявок и полученных результатов
8. **Экспорт в Excel** - выгрузка информации об обработанных заявках в табличном виде

## Стек

- **Frontend**: SvelteKit
- **Backend API**: SvelteKit API routes (`+server.ts`)
- **Бизнес-логика**: TypeScript в `lib/business/` (чистые функции, без зависимостей от UI)
- **AI**: LangChain.js
- **Валидация**: Zod схемы (для structured output)
- **REST API**: явные эндпоинты для интеграции в другие системы

## Ключевые требования

1. **Разделение логики**:
   - Бизнес-логика в `lib/business/` (чистые функции)
   - UI в `routes/` и `lib/components/`
   - REST API в `routes/api/`

2. **Structured output**: LLM должен возвращать типизированный JSON через Zod схемы

3. **Поддержка множественных ТУ**

4. **Асинхронная обработка**: долгие операции не блокируют UI

## Архитектура пайплайна обработки заявки

1. Инициация обработки заявки - пользователь передает файл и выбирает ТУ (Web UI, REST)
2. Извлечение текста из файла - OCR
3. Извлечение полей из текста - LLM опирается на ТУ и выдает structured output
4. Сохранение результата обработки

## UI компоненты

- Форма загрузки файла (drag-n-drop)
- Выбор ТУ (selectbox)
- Поле для примечаний
- Автоматическое заполнение через AI (кнопка)
- Финальное обозначение продукции (отображается автоматически)
- Дашборд с таблицей заявок и фильтрацией по датам

## Особенности бизнес-логики

- Ограничение текста для LLM: первые 6000 символов
- Логирование шагов в `messages` для отладки
- Валидация: LLM не должен придумывать параметры, только извлекать из текста
- Сопоставление: коды должны сверяться с ТУ (например, ВД, У1)


## Полезные материалы
https://dev.to/dj_nuo/neverthrow-tutorial-with-a-bit-of-byethrow-2poa